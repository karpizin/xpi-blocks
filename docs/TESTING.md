# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ XPI-Blocks

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `pytest` —Å–æ–≤–º–µ—Å—Ç–Ω–æ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è ROS2 (`ament_cmake_pytest`).

## üõ† –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –ª–æ–∫–∞–ª—å–Ω–æ (–¥–∞–∂–µ –Ω–∞ Mac/Windows) –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –∂–µ–ª–µ–∑–∞:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —ç–º—É–ª—è—Ç–æ—Ä–∞ GPIO
export GPIOZERO_PIN_FACTORY=mock
```

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

### –ß–µ—Ä–µ–∑ colcon (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
–≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Å–æ–±–µ—Ä–µ—Ç –ø–∞–∫–µ—Ç—ã –∏ –∑–∞–ø—É—Å—Ç–∏—Ç –≤—Å–µ —Ç–µ—Å—Ç—ã –≤ –≤–æ—Ä–∫—Å–ø–µ–π—Å–µ:
```bash
colcon test --packages-select xpi_sensors
colcon test-result --verbose
```

### –ù–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ pytest
–î–ª—è –±—ã—Å—Ç—Ä–æ–π –æ—Ç–ª–∞–¥–∫–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ñ–∞–π–ª–∞:
```bash
pytest src/xpi_sensors/test/test_sonar_node.py
```

## üß© –ü—Ä–∏–Ω—Ü–∏–ø—ã –Ω–∞–ø–∏—Å–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤

1.  **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ MagicMock**: –ú—ã –ø–æ–¥–º–µ–Ω—è–µ–º –æ–±—ä–µ–∫—Ç—ã `sensor` –∏–ª–∏ `bus`, —á—Ç–æ–±—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ ROS-—Å–æ–æ–±—â–µ–Ω–∏–π –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –∂–µ–ª–µ–∑–∞.
2.  **–ò–∑–æ–ª—è—Ü–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞**: –ö–∞–∂–¥—ã–π —Ç–µ—Å—Ç –¥–æ–ª–∂–µ–Ω —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–≤–µ—Ä—à–∞—Ç—å –Ω–æ–¥—É.
3.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤**: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∏–ø—ã –∏ –≥—Ä–∞–Ω–∏—Ü—ã –∑–Ω–∞—á–µ–Ω–∏–π –ø—É–±–ª–∏–∫—É–µ–º—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (`sensor_msgs`).

–ü—Ä–∏–º–µ—Ä –º–æ–∫–∞ –¥–ª—è I2C:
```python
from unittest.mock import MagicMock
mock_bus = MagicMock()
mock_bus.read_byte_data.return_value = 0x42
```
