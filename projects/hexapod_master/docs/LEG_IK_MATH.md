# Математика Обратной Кинематики (3-DOF Leg)

Этот документ описывает процесс перевода координат цели $(x, y, z)$ в углы поворота трех сервоприводов лапы гексапода.

## Схема лапы и параметры
Лапа состоит из трех звеньев:
1.  **Coxa (L1)**: Бедро (горизонтальное вращение).
2.  **Femur (L2)**: Плечо (вертикальное вращение).
3.  **Tibia (L3)**: Голень (вертикальное вращение).

**Входные данные:**
*   $x, y, z$ — координаты кончика лапы (Tiptoe) относительно центра вращения Coxa.
*   $L_1, L_2, L_3$ — длины соответствующих звеньев.

---

## 1. Расчет угла Coxa ($	heta_1$)
Это вращение в плоскости XY. 
$$\theta_1 = \operatorname{atan2}(y, x)$$

## 2. Переход в 2D плоскость лапы
Чтобы найти углы Femur и Tibia, мы проецируем лапу на вертикальную плоскость, определяемую углом $	heta_1$.
*   Горизонтальное расстояние от сустава Femur до цели:
    $$r = \sqrt{x^2 + y^2} - L_1$$
*   Полное расстояние от сустава Femur до цели (гипотенуза):
    $$s = \sqrt{r^2 + z^2}$$

## 3. Расчет углов Femur ($	heta_2$) и Tibia ($	heta_3$)
Используем теорему косинусов для треугольника, образованного звеньями $L_2, L_3$ и воображаемым отрезком $s$.

### Угол Tibia ($	heta_3$)
$$\cos(\gamma) = \frac{L_2^2 + L_3^2 - s^2}{2 \cdot L_2 \cdot L_3}$$
$$\theta_3 = \operatorname{acos}(\cos(\gamma)) - 180^°$$ 
*(Знак зависит от направления вращения сервопривода)*

### Угол Femur ($	heta_2$)
Сначала найдем угол наклона отрезка $s$ к горизонту:
$$\alpha_1 = \operatorname{atan2}(z, r)$$
Затем найдем внутренний угол треугольника у сустава Femur:
$$\cos(\beta) = \frac{L_2^2 + s^2 - L_3^2}{2 \cdot L_2 \cdot s}$$
$$\alpha_2 = \operatorname{acos}(\cos(\beta))$$
Финальный угол:
$$\theta_2 = \alpha_1 + \alpha_2$$

---

## Ограничения и проверки
1.  **Проверка достижимости:** Если $s > L_2 + L_3$, точка находится вне зоны досягаемости.
2.  **Сингулярность:** Если $s < |L_2 - L_3|$, лапа "складывается" сама в себя.
3.  **Углы серв:** Полученные радианы нужно перевести в градусы и ограничить диапазоном (обычно 0-180°).
